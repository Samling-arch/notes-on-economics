[12 添加表记录【待2】
_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1mxrfYsEyP?spm_id_from=333.788.videopod.episodes&vd_source=ee9d30f304bf8071b67bef309a4dabf6&p=12)
# 1 MySQL从基础到进阶 - 第五章 表记录操作 (BV1mxrfYsEyP)
苑昊老师 2024-12-18 15:23:40
## 1.1 章节引言：为什么第五章是重中之重？
*   **通俗概括**：这一章教我们怎么往数据库的“小本本”（表）里写、改、删、查具体的内容（记录），这比学会怎么建“小本本”本身更重要，因为程序员打交道最多的就是这些具体内容。
*   **回顾**：
    *   第三章：数据库的增删改查 (比如创建一个新的数据库)
    *   第四章：数据表的增删改查 (比如在一个数据库里创建一张学生信息表)
    *   **第五章：表记录的增删改查 (比如在学生信息表里添加一个叫“小明”的学生的信息)**
*   **重要性对比**：老师强调，第三章和第四章加起来的重要性，可能都不如第五章。
    *   **原因**：程序员的核心能力是处理**数据**。数据库、数据表只是存储数据的**容器**或**载体**。我们真正关心和操作的是表里面一行一行的**记录 (records)**。
    *   所以，第五章是核心中的核心！
*   **第五章内容细分**：增、删、改、查。
    *   **查询 (SELECT)** 是核心中的核心，会占到学习精力的 $60\% \sim 70\%$，甚至 $70\% \sim 80\%$。它知识点多，比较难。
    *   学好了查询，更新 (UPDATE) 和删除 (DELETE) 就相对简单了，因为它们的前提往往是“先查到你想操作的那条记录”。
    *   **添加 (INSERT)** 语法相对简单，主要就是两条 `INSERT` 语句。
## 1.2 第一节：添加记录 (INSERT INTO)
*   **通俗概括**：这节课我们学习怎么往已经存在的表里添加新的数据行。
### 1.2.1 什么是添加记录？
*   **通俗概括**：就像我们有一个Excel表格，里面有表头（字段），我们现在要做的就是在下面新添一行具体的数据。
*   **前提**：
    1.  要有一张**表 (table)** 已经存在。
    2.  表里面定义好了**字段 (columns/fields)**，比如姓名、年龄、性别等。
*   **操作**：根据这些字段，向表里插入一条条具体的**记录 (rows/records)**。
*   **Excel类比**：
    *   Excel文件本身 ≈ 数据库
    *   Excel里的一个Sheet (工作表) ≈ 数据表 (table)
    *   Sheet里的表头 (如：学号, 姓名, 年龄) ≈ 字段 (columns)
    *   Sheet里每一行的数据 (如：1, 张三, 18) ≈ 一条记录 (record)
    *   我们这节课要学的就是怎么**添加新的一行数据**。
### 1.2.2 `INSERT` 语句的语法格式
*   **通俗概括**：`INSERT`语句的基本格式是告诉数据库“我要往哪个表的哪些字段里插入哪些值”。
*   **基本语法**：
    ```sql
    INSERT [INTO] table_name [(column_name1, column_name2, ...)] 
    VALUES (value1, value2, ...);
    ```
*   **语法解析**：
    *   `INSERT`: 关键字，表示要插入数据。
    *   `[INTO]`: 可选关键字。写上 `INSERT INTO` 更规范，但只写 `INSERT` 通常也可以。
    *   `table_name`: 要插入数据的表名。
    *   `(column_name1, column_name2, ...)`: **可选部分**。指定要为哪些字段插入值。
        *   这里的字段名顺序**可以不按照**表定义时的顺序。比如表定义时是 `id, name, age`，你插入时可以写 `(age, name)`。
        *   **非常重要的一点**：如果你在这里指定了字段名，那么 `VALUES` 子句里的值的顺序和数量**必须**与这里指定的字段名一一对应。
    *   `VALUES (value1, value2, ...)`: **必须部分**。提供要插入的具体值。
        *   值的顺序和数量必须与前面括号里指定的字段名对应。
        *   如果省略了前面的字段名列表，那么这里的值必须覆盖表中的**所有字段**，并且顺序必须与表定义时字段的顺序**完全一致**。
*   **核心细节：字段与值的对应关系**
    *   **问题**：插入一条记录时，是否必须为所有字段都提供值？
    *   **答案**：不一定。
        *   如果一个字段在创建表时设置了允许为 `NULL` (即 `DEFAULT NULL` 或者没有显式指定 `NOT NULL`)，或者设置了**默认值 (DEFAULT value)**，那么在插入记录时，这个字段可以不出现在 `(column_name1, ...)` 列表中，数据库会自动使用 `NULL` 或其默认值。
        *   如果一个字段被定义为 `NOT NULL` 并且没有默认值，那么在插入记录时，**必须**为这个字段提供一个值。
    *   **好处**：这种灵活性允许我们只插入我们关心的、或者当时拥有的数据，而不是每次都填写所有字段。
### 1.2.3 实践前的准备：PyCharm SQL 文件模板配置 (小技巧)
*   **通俗概括**：这是一个在PyCharm里快速创建 `.sql` 文件的小技巧，可以提高效率，不用每次都手动加 `.sql` 后缀。
*   **问题**：每次在PyCharm里新建SQL文件，都要手动添加 `.sql` 后缀，比较麻烦。
*   **解决方案**：配置一个SQL文件模板。
    1.  打开PyCharm设置 (File -> Settings, 或者 `Ctrl+Alt+S`)。
    2.  导航到 `Editor` -> `File and Code Templates`。
    3.  点击右上角的 `+` (Add)按钮。
    4.  在 `Name` 处输入：`SQL` (或者你喜欢的任何名字，比如 `My SQL File`)。
    5.  在 `Extension` 处输入：`sql` (注意是小写)。
    6.  点击 `Apply` 然后 `OK`。
*   **效果**：之后在项目文件夹上右键 `New` 时，就会看到你刚创建的 `SQL` 选项，点击它创建文件时会自动带上 `.sql` 后缀。
### 1.2.4 实践操作：添加单条记录
*   **老师的环境说明**：
    *   文件名：`05_添加表记录.sql`
    *   本节主要讲：
        1.  添加一条记录
        2.  批量添加记录 (下节内容)
#### 1.2.4.1 第一步：创建示例表 `student`
*   **通俗概括**：在操作数据前，我们首先需要一张表作为数据的“容器”。
*   **问题**：当前数据库里没有表，需要先创建一张。
*   **SQL语句** (直接从老师那里复制，因为之前章节学过 `CREATE TABLE`)：
    ```sql
    -- 创建表 student
    CREATE TABLE student (
        id INT PRIMARY KEY AUTO_INCREMENT, -- 学号，整数，主键，自动增长
        name VARCHAR(255) NOT NULL,       -- 姓名，字符串，不能为空
        gender BIT DEFAULT NULL,          -- 性别，比特位(0或1)，默认为NULL
        age INT,                          -- 年龄，整数
        birth_date DATE                   -- 出生日期，日期类型
    );
    ```
*   **字段解释**：
    *   `id INT PRIMARY KEY AUTO_INCREMENT`: `id`是整数类型，是这张表的主键（唯一标识一条记录），并且会自动增长（比如第一条记录是$1$，下一条就是$2$，不需要我们手动指定）。
    *   `name VARCHAR(255) NOT NULL`: `name`是字符串类型，最大长度$255$个字符，并且不能为空 (`NOT NULL`)。
    *   `gender BIT DEFAULT NULL`: `gender`是比特类型，通常用来存 $0$ 或 $1$ (比如代表女或男)。如果插入时不指定，默认为 `NULL` (未知)。
    *   `age INT`: `age`是整数类型。
    *   `birth_date DATE`: `birth_date`是日期类型，专门用来存年、月、日。
*   **执行 `CREATE TABLE` 语句**：
    1.  **重要**：在PyCharm中执行SQL前，需要确保你已经连接到了一个数据库实例，并且选中了要在哪个数据库 (Schema) 下执行。老师这里选择的是他之前创建的 `DB_01`。
        *   如果没有关联数据源，PyCharm会提示 "No data sources are configured..."
        *   操作：在编辑器顶部或右侧找到数据源选择的地方，关联到你的目标数据库。
    2.  选中 `CREATE TABLE` 语句。
    3.  右键 -> `Run` (或者使用快捷键，通常是 `Ctrl+Enter`)。
    4.  执行成功后，刷新数据库的表列表，应该能看到 `student` 表了。
#### 1.2.4.2 插入记录 - 指定单列 (只插入 `name`)
*   **通俗概括**：我们可以只给表中的某一个必填字段（比如姓名）插入值，其他有默认值或允许为空的字段会自动处理。
*   **分析**：
    *   `id`：因为是 `AUTO_INCREMENT`，我们不需要手动插入，数据库会自动分配。
    *   `name`：是 `NOT NULL`，所以**必须**提供值。
    *   `gender`：有 `DEFAULT NULL`，可以不提供，会使用 `NULL`。
    *   `age`：没有 `NOT NULL` 也没有默认值，不提供则为 `NULL`。
    *   `birth_date`：没有 `NOT NULL` 也没有默认值，不提供则为 `NULL`。
    *   所以，最少只需要提供 `name` 字段的值。
*   **SQL语句**：
    ```sql
    INSERT INTO student (name) VALUES ('苑'); 
    ```
    *   `student`: 表名。
    *   `(name)`: 指定我们要为 `name` 字段插入值。
    *   `VALUES ('苑')`: 对应的值是字符串 `'苑'`。注意字符串值要用单引号括起来。
*   **执行与观察**：
    *   执行语句。PyCharm的控制台会显示执行结果，比如 "1 row affected in 4ms"。
    *   老师提到，他写的SQL没有语法错误，但PyCharm有时可能会有不准确的红色波浪线提示。他尝试切换SQL方言 (Dialect) 为 "Generic SQL" 看看是否能改善，但这不是主要问题。
    *   **查看数据**：在PyCharm的数据库工具窗口中，双击 `student` 表，可以看到刚才插入的数据。`id` 应该是 $1$，`name` 是 `苑`，其他字段是 `NULL`。
*   **可以插入重复的 `name` 吗？**
    *   老师又执行了一遍 `INSERT INTO student (name) VALUES ('苑');`
    *   结果是可以的。因为 `name` 字段只设置了 `NOT NULL`，没有设置唯一约束 (`UNIQUE`)。所以可以有多条记录的 `name` 都是 `'苑'`。此时第二条记录的 `id` 会是 $2$。
#### 1.2.4.3 插入记录 - 指定多列 (顺序可自定义)
*   **通俗概括**：插入数据时，指定字段的顺序可以随意，只要值列表中的值与之对应即可。
*   **SQL语句**：
    ```sql
    INSERT INTO student (age, name) VALUES (28, 'Rain');
    ```
    *   这里我们先指定了 `age` 字段，再指定了 `name` 字段。
    *   `VALUES (28, 'Rain')`: 对应的值就是年龄 $28$ (数字不用引号)，姓名 `'Rain'`。
    *   顺序必须匹配：`age` 对应 $28$，`name` 对应 `'Rain'`。
*   **执行与观察**：
    *   执行成功。
    *   查看 `student` 表，会新增一条记录：`id` 可能是 $3$，`name` 是 `Rain`，`age` 是 $28$，`gender` 和 `birth_date` 是 `NULL`。
#### 1.2.4.4 插入记录 - 省略列名 (不推荐)
*   **通俗概括**：如果要给表里的所有字段都按顺序提供值，可以省略字段名列表，但这非常容易出错，不推荐在实际开发中使用。
*   **语法**：
    ```sql
    INSERT INTO student VALUES (value_for_id, value_for_name, value_for_gender, value_for_age, value_for_birth_date);
    ```
    *   **注意**：当省略字段名列表时，`VALUES` 列表中的值的数量和顺序**必须**与表定义时字段的数量和顺序**完全一致**。
*   **查看表结构和字段顺序**：
    *   如果不确定字段顺序，可以使用 `DESC` (describe) 命令查看：
        ```sql
        DESC student;
        ```
    *   执行后会显示 `student` 表的字段信息，包括名称、类型、是否允许`NULL`、键信息、默认值等，以及它们的**定义顺序**。
    *   对于 `student` 表，顺序是：`id`, `name`, `gender`, `age`, `birth_date`。
*   **尝试插入 (并故意犯错)**：
    *   假设我们想插入 `id`为$4$，`name`为`'艾瑞克'`，`gender`为$1$ (男性)，`age`为$23$，`birth_date`为`'2020-12-12'`。
    *   **错误的尝试** (老师演示时，把年龄和性别的值顺序搞反了)：
        ```sql
        -- 错误的顺序：把age的值(23)放到了gender的位置
        INSERT INTO student VALUES (4, '艾瑞克', 23, 1, '2020-12-12'); 
        ```
    *   **错误分析**：
        *   `id` -> $4$ (OK)
        *   `name` -> `'艾瑞克'` (OK)
        *   `gender` -> $23$ (错误!) `gender` 字段是 `BIT` 类型，它期望的是 $0$ 或 $1$ (或者 `b'0'` / `b'1'`)。给它一个 $23$ 会导致错误。
        *   老师遇到的报错信息是: "Data too long for column 'gender' at row 1"。意思是给 `gender` 字段的数据太长了 (因为 $23$ 对于 `BIT(1)` 来说超范围了)。
        *   如果 `gender` 字段恰好也是 `INT` 类型，那么这个错误的赋值可能不会直接报错，但会导致数据逻辑混乱（年龄存到了性别字段，性别存到了年龄字段）。
*   **正确的插入 (省略列名)**：
    ```sql
    -- 正确的顺序
    INSERT INTO student VALUES (4, '艾瑞克', 1, 23, '2020-12-12');
    ```
    *   `id` -> $4$
    *   `name` -> `'艾瑞克'`
    *   `gender` -> $1$
    *   `age` -> $23$
    *   `birth_date` -> `'2020-12-12'` (日期格式 `'YYYY-MM-DD'`)
*   **执行与观察**：
    *   执行成功。
    *   查看 `student` 表，`艾瑞克` 的信息被正确插入，`id`为$4$，`birth_date` 也正确显示。
*   **为什么不推荐省略列名？**
    1.  **可读性差**：看代码的人需要去查表结构才能知道每个值对应哪个字段。
    2.  **易出错**：字段顺序很容易记错，尤其当表字段很多时。
    3.  **维护性差**：如果将来表结构发生改变（比如调整了字段顺序，或增删了字段），所有省略列名的 `INSERT` 语句都可能需要修改，否则就会出错。
    *   **推荐做法**：总是明确指定列名 `INSERT INTO table_name (col1, col2) VALUES (val1, val2);` 这样更清晰、更安全、更易维护。
#### 1.2.4.5 插入记录 - `DATE` 类型注意事项
*   **通俗概括**：插入日期数据时，要使用特定格式，比如 'YYYY-MM-DD'，乱用分隔符可能会出错或不被推荐。
*   **回顾**：上一个例子中，`birth_date` 我们用的是 `'2020-12-12'`，这是MySQL接受的标准日期格式之一。
*   **尝试其他日期格式 (老师演示)**：
    *   目标：插入 `name` 为 `'Eleven'`，`age` 为 $28$，`birth_date` 为 `'1996-12-12'`。
        ```sql
        INSERT INTO student (name, age, birth_date) 
        VALUES ('Eleven', 28, '1996-12-12'); -- 使用连字符 '-' 作为分隔符
        ```
        这个是标准的，可以成功。
    *   **尝试使用斜杠 `/` 作为分隔符**：
        ```sql
        INSERT INTO student (name, age, birth_date) 
        VALUES ('ElevenSlash', 28, '1996/12/12'); 
        ```
        *   执行时，老师的MySQL版本给出了一个警告 (Warning) 或者直接错误，提示类似 "Incorrect date value..." 或者提到分隔符用法被废弃 (`deprecated`)。
        *   `deprecated` (发音：/ˈdep.rə.keɪ.tɪd/)：意为“不赞成使用；已过时；已弃用”。表示这个语法或功能在旧版本中可能被支持，但现在不推荐使用，未来版本中可能会被移除。
    *   **尝试使用点 `.` 作为分隔符**：
        ```sql
        INSERT INTO student (name, age, birth_date) 
        VALUES ('ElevenDot', 28, '1996.12.12'); 
        ```
        *   同样，也可能遇到 `deprecated` 警告或错误。
*   **结论**：
    *   向 `DATE`类型的字段插入值时，最安全、最推荐的格式是 `'YYYY-MM-DD'` (年-月-日，用连字符分隔)。
    *   其他格式（如 `'YYYY/MM/DD'` 或 `'YYYY.MM.DD'`）即使在某些MySQL版本或配置下能工作，也可能是不被推荐的 (`deprecated`)，应避免使用，以保证兼容性和代码的健壮性。
## 1.3 总结与展望
*   **本节回顾**：我们学习了单条记录插入的两种主要方式：
    1.  `INSERT INTO table_name (column_list) VALUES (value_list);` (推荐)
    2.  `INSERT INTO table_name VALUES (all_values_in_order);` (不推荐)
    *   以及插入数据时的一些注意事项，特别是关于 `NOT NULL` 字段、`AUTO_INCREMENT`、默认值和 `DATE` 类型的格式。
*   **下节预告**：
    *   批量添加记录 (一次插入多条记录)
    *   `INSERT ... SET ...` 语法 (另一种插入单条记录的方式，更像更新语句的写法)
好了同学，关于单条记录的添加就讲到这里。你是不是对 `INSERT` 语句有了更清晰的认识呢？记得多动手练习一下哦！