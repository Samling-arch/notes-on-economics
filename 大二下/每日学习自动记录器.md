---
date: <% tp.date.now("YYYY-MM-DD") %>
time: <% tp.date.now("HH:mm:ss") %>
auto_generated: true
type: daily-report
tags: [daily, auto-record, learning-analytics]
---

# ğŸ“Š æ¯æ—¥å­¦ä¹ è‡ªåŠ¨æŠ¥å‘Š - <% tp.date.now("YYYYå¹´MMæœˆDDæ—¥") %>

## ğŸ¯ ä»Šæ—¥å­¦ä¹ æ¦‚è§ˆ

<%*
// ====================================
// ğŸ“Š æ¯æ—¥å­¦ä¹ è‡ªåŠ¨è®°å½•å™¨
// å®šæ—¶ä»»åŠ¡ï¼šæ¯å¤©10:00è‡ªåŠ¨æ‰§è¡Œ
// ====================================

class DailyLearningReporter {
    constructor() {
        this.app = app;
        this.tp = tp;
        this.today = new Date().toISOString().split('T')[0];
        this.todayDisplay = new Date().toLocaleDateString('zh-CN', {
            year: 'numeric',
            month: 'long', 
            day: 'numeric',
            weekday: 'long'
        });
    }

    // è·å–ä»Šæ—¥å·²å­¦ä¹ çš„æ–‡ä»¶
    getTodayStudiedFiles() {
        try {
            return this.app.vault.getMarkdownFiles()
                .filter(file => {
                    try {
                        const cache = this.app.metadataCache.getFileCache(file);
                        const lastStudied = cache?.frontmatter?.last_studied;
                        const modified = cache?.frontmatter?.modified;
                        
                        // æ£€æŸ¥ä»Šæ—¥å­¦ä¹ è®°å½•æˆ–ä»Šæ—¥ä¿®æ”¹è®°å½•
                        return lastStudied === this.today || 
                               (modified && modified.includes(this.today));
                    } catch (error) {
                        return false;
                    }
                })
                .map(file => {
                    const cache = this.app.metadataCache.getFileCache(file);
                    const frontmatter = cache?.frontmatter || {};
                    return {
                        name: file.basename,
                        path: file.path,
                        subject: frontmatter.subject || this.detectSubjectFromPath(file.path),
                        progress: frontmatter.progress || 0,
                        study_hours: frontmatter.study_hours || 0,
                        edit_duration: frontmatter.edit_duration || 0,
                        study_pattern: frontmatter.study_pattern || 'æœªçŸ¥'
                    };
                });
        } catch (error) {
            console.warn('è·å–ä»Šæ—¥å­¦ä¹ æ–‡ä»¶å¤±è´¥:', error);
            return [];
        }
    }

    // ä»è·¯å¾„æ£€æµ‹ç§‘ç›®
    detectSubjectFromPath(filePath) {
        const subjectMap = {
            'L4è´¢åŠ¡ç®¡ç†å­¦': 'è´¢åŠ¡ç®¡ç†å­¦',
            'L5 æŠ•èµ„å­¦': 'æŠ•èµ„å­¦', 
            'LæŠ•èµ„å­¦': 'æŠ•èµ„å­¦',
            'L7ç»Ÿè®¡å­¦': 'ç»Ÿè®¡å­¦',
            'L_ç»æµæ³•': 'ç»æµæ³•',
            'L2_åˆ¶åº¦ç»æµå­¦': 'åˆ¶åº¦ç»æµå­¦',
            'L6è´¢æ”¿å­¦': 'è´¢æ”¿å­¦',
            'L3æ¯›æ¦‚': 'æ¯›æ¦‚'
        };

        for (const [key, value] of Object.entries(subjectMap)) {
            if (filePath.includes(key)) {
                return value;
            }
        }
        return 'æœªåˆ†ç±»';
    }

    // è·å–ç§‘ç›®ç»Ÿè®¡
    getSubjectStats(files) {
        const stats = {};
        
        files.forEach(file => {
            const subject = file.subject;
            if (!stats[subject]) {
                stats[subject] = {
                    count: 0,
                    totalTime: 0,
                    avgProgress: 0,
                    files: []
                };
            }
            
            stats[subject].count++;
            stats[subject].totalTime += Math.round(file.edit_duration / 60) || 0; // è½¬æ¢ä¸ºåˆ†é’Ÿ
            stats[subject].files.push(file.name);
        });

        // è®¡ç®—å¹³å‡è¿›åº¦
        Object.keys(stats).forEach(subject => {
            const subjectFiles = files.filter(f => f.subject === subject);
            const totalProgress = subjectFiles.reduce((sum, f) => {
                let progress = 0;
                if (typeof f.progress === 'string' && f.progress.includes('%')) {
                    progress = parseInt(f.progress.replace('%', ''));
                } else if (typeof f.progress === 'number') {
                    progress = f.progress;
                }
                return sum + progress;
            }, 0);
            
            stats[subject].avgProgress = Math.round(totalProgress / subjectFiles.length) || 0;
        });

        return stats;
    }

    // è·å–å­¦ä¹ è¿å‡»ç»Ÿè®¡
    getStudyStreak() {
        try {
            const files = this.app.vault.getMarkdownFiles();
            const studyDates = new Set();
            
            files.forEach(file => {
                try {
                    const cache = this.app.metadataCache.getFileCache(file);
                    const lastStudied = cache?.frontmatter?.last_studied;
                    if (lastStudied && typeof lastStudied === 'string') {
                        studyDates.add(lastStudied);
                    }
                } catch (error) {
                    // å¿½ç•¥é”™è¯¯
                }
            });

            const sortedDates = Array.from(studyDates).sort().reverse();
            let streak = 0;
            
            for (let i = 0; i < sortedDates.length; i++) {
                const expectedDate = new Date();
                expectedDate.setDate(expectedDate.getDate() - i);
                const expectedDateStr = expectedDate.toISOString().split('T')[0];
                
                if (sortedDates[i] === expectedDateStr) {
                    streak++;
                } else {
                    break;
                }
            }
            
            return streak;
        } catch (error) {
            return 0;
        }
    }

    // ç”Ÿæˆæ¯æ—¥æŠ¥å‘Š
    generateDailyReport() {
        const todayFiles = this.getTodayStudiedFiles();
        const subjectStats = this.getSubjectStats(todayFiles);
        const streak = this.getStudyStreak();
        
        return {
            todayFiles,
            subjectStats,
            streak,
            totalFiles: todayFiles.length,
            totalTime: todayFiles.reduce((sum, f) => sum + Math.round(f.edit_duration / 60), 0),
            timestamp: new Date().toLocaleString('zh-CN')
        };
    }
}

// æ‰§è¡Œæ¯æ—¥æŠ¥å‘Šç”Ÿæˆ
try {
    const reporter = new DailyLearningReporter();
    const report = reporter.generateDailyReport();

    // è¾“å‡ºæŠ¥å‘Šå†…å®¹
    tR += `**ğŸ“… æ—¥æœŸ**: ${reporter.todayDisplay}\n`;
    tR += `**â° ç”Ÿæˆæ—¶é—´**: ${report.timestamp}\n\n`;

    // ä»Šæ—¥æ¦‚è§ˆ
    tR += `### ğŸ“ˆ ä»Šæ—¥å­¦ä¹ æ¦‚è§ˆ\n\n`;
    tR += `- **ğŸ“š å­¦ä¹ æ–‡ä»¶æ•°**: ${report.totalFiles} ä¸ª\n`;
    tR += `- **â±ï¸ æ€»å­¦ä¹ æ—¶é•¿**: ${report.totalTime} åˆ†é’Ÿ\n`;
    tR += `- **ğŸ”¥ å­¦ä¹ è¿å‡»**: ${report.streak} å¤©\n\n`;

    // ç§‘ç›®è¯¦æƒ…
    if (Object.keys(report.subjectStats).length > 0) {
        tR += `### ğŸ“Š ç§‘ç›®å­¦ä¹ è¯¦æƒ…\n\n`;
        
        Object.entries(report.subjectStats).forEach(([subject, stats]) => {
            tR += `#### ${subject}\n`;
            tR += `- **æ–‡ä»¶æ•°é‡**: ${stats.count} ä¸ª\n`;
            tR += `- **å­¦ä¹ æ—¶é•¿**: ${stats.totalTime} åˆ†é’Ÿ\n`;
            tR += `- **å¹³å‡è¿›åº¦**: ${stats.avgProgress}%\n`;
            tR += `- **å­¦ä¹ æ–‡ä»¶**: ${stats.files.join(', ')}\n\n`;
        });
    }

    // ä»Šæ—¥å­¦ä¹ æ–‡ä»¶åˆ—è¡¨
    if (report.todayFiles.length > 0) {
        tR += `### ğŸ“‹ ä»Šæ—¥å­¦ä¹ æ–‡ä»¶åˆ—è¡¨\n\n`;
        tR += `| æ–‡ä»¶å | ç§‘ç›® | è¿›åº¦ | å­¦ä¹ æ¨¡å¼ |\n`;
        tR += `|--------|------|------|----------|\n`;
        
        report.todayFiles.forEach(file => {
            const progress = typeof file.progress === 'string' ? file.progress : `${file.progress}%`;
            tR += `| ${file.name} | ${file.subject} | ${progress} | ${file.study_pattern} |\n`;
        });
        tR += `\n`;
    } else {
        tR += `### ğŸ’­ ä»Šæ—¥å­¦ä¹ æé†’\n\n`;
        tR += `ğŸ“ ä»Šå¤©è¿˜æ²¡æœ‰å­¦ä¹ è®°å½•ï¼Œå¿«å¼€å§‹æ–°çš„å­¦ä¹ å§ï¼\n\n`;
        tR += `ğŸ’¡ **å»ºè®®**:\n`;
        tR += `- ğŸ¯ åˆ¶å®šä»Šæ—¥å­¦ä¹ ç›®æ ‡\n`;
        tR += `- ğŸ“– é€‰æ‹©ä¸€ä¸ªç§‘ç›®å¼€å§‹å­¦ä¹ \n`;
        tR += `- â° å®‰æ’åˆç†çš„å­¦ä¹ æ—¶é—´\n\n`;
    }

    // å­¦ä¹ å»ºè®®
    tR += `### ğŸ’¡ æ™ºèƒ½å­¦ä¹ å»ºè®®\n\n`;
    
    if (report.streak === 0) {
        tR += `ğŸš€ **å¼€å§‹æ–°çš„å­¦ä¹ æ—…ç¨‹**: å»ºè®®ä»Šå¤©å¼€å§‹å»ºç«‹å­¦ä¹ ä¹ æƒ¯ï¼\n`;
    } else if (report.streak < 7) {
        tR += `ğŸ“ˆ **ä¿æŒå­¦ä¹ èŠ‚å¥**: å·²è¿ç»­å­¦ä¹ ${report.streak}å¤©ï¼Œç»§ç»­ä¿æŒï¼\n`;
    } else if (report.streak < 30) {
        tR += `ğŸ”¥ **å­¦ä¹ çŠ¶æ€ä¼˜ç§€**: è¿ç»­${report.streak}å¤©å­¦ä¹ ï¼Œéå¸¸æ£’ï¼\n`;
    } else {
        tR += `ğŸ‘‘ **å­¦ä¹ å¤§å¸ˆ**: è¿ç»­${report.streak}å¤©å­¦ä¹ ï¼Œä½ æ˜¯å­¦ä¹ æ¦œæ ·ï¼\n`;
    }

    if (report.totalTime > 0) {
        if (report.totalTime < 30) {
            tR += `â° **å»ºè®®å¢åŠ å­¦ä¹ æ—¶é•¿**: ä»Šæ—¥${report.totalTime}åˆ†é’Ÿï¼Œå»ºè®®å¢åŠ åˆ°60åˆ†é’Ÿä»¥ä¸Š\n`;
        } else if (report.totalTime < 120) {
            tR += `âœ… **å­¦ä¹ æ—¶é•¿åˆç†**: ä»Šæ—¥${report.totalTime}åˆ†é’Ÿï¼Œä¿æŒè‰¯å¥½ä¹ æƒ¯\n`;
        } else {
            tR += `ğŸ–ï¸ **å­¦ä¹ æ—¶é•¿å……è¶³**: ä»Šæ—¥${report.totalTime}åˆ†é’Ÿï¼Œå­¦ä¹ å¼ºåº¦å¾ˆé«˜ï¼\n`;
        }
    }

    tR += `\n---\n\n`;
    tR += `> ğŸ¤– **è‡ªåŠ¨ç”ŸæˆæŠ¥å‘Š** | ğŸ’¾ **ä¿å­˜ä½ç½®**: å¤§äºŒä¸‹æ–‡ä»¶å¤¹ | ğŸ”„ **æ¯æ—¥10:00è‡ªåŠ¨æ›´æ–°**\n`;

} catch (error) {
    tR += `âŒ **æŠ¥å‘Šç”Ÿæˆå¤±è´¥**: ${error.message}\n`;
    tR += `**é”™è¯¯æ—¶é—´**: ${new Date().toLocaleString('zh-CN')}\n`;
}
%> 