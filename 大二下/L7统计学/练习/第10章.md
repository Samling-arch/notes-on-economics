                
# 1 第十章 强化课：方差分析 (ANOVA)

## 1.1 一、核心概念与选择题要点

### 1.1.1 方差分析 (ANOVA) 的基本认知
- **目的**: 判断**分类型自变量**对**数值型因变量**的影响。 (题1)
- **核心思想**: 检验多个总体均值是否相等。通过检验各总体均值之间的差异是否显著，来判断分类型自变量对数值型因变量的影响。
- **因子 (Factor)**: 指的就是分类型自变量。
    - **单因素方差分析**: 只涉及 `$1$` 个分类型自变量。(题9)
    - **双因素方差分析**: 涉及 `$2$` 个分类型自变量。(题10)

### 1.1.2 方差分析的三个基本假定 (题7)
1.  **正态性**: 每个总体的样本都来自于一个正态分布。
2.  **方差齐性**: 各个总体的方差相等。
    > [!caution] 注意
    > 假设是方差相等，而不是方差等于$0$。如果方差为$0$，样本值就恒为常数，失去了随机性。
3.  **独立性**: 样本数据之间是相互独立的。

### 1.1.3 误差分解与来源
- **组内误差 (Within-Group Variation)**
    - **定义**: 某一个水平（同一个样本/组）下的数据之间的误差。(题3, 题6)
    - **来源**: **只包含随机误差**。
- **组间误差 (Between-Group Variation)**
    - **定义**: 不同水平（不同样本/组）下的数据之间的误差。(题4)
    - **来源**: **既包含随机误差，也包含系统误差** (由自变量不同水平导致的差异)。(题5)

### 1.1.4 平方和 (Sum of Squares, SS)
- **组内平方和 (SSE)**: 同一个样本/水平下的数据与其均值差异的平方和，反映了**组内**的离散程度。(题11)
- **组间平方和 (SSA/SSR)**: 各个样本/水平的均值与总均值差异的平方和，反映了**组间**的离散程度。(题12)
- **总平方和 (SST)**: 全部观测值与总均值差异的平方和。(题13)
- **基本关系式**:
    $$SST = SSA + SSE$$

### 1.1.5 均方 (Mean Square, MS)
> [!quote] UP主吐槽
> 我其实最烦同一个东西，有两个名字...你相当于是两个名字都需要记一下，这个很恶心的。

- **组内均方 (MSE)**: 也叫**组内方差**。
    $$MSE = \frac{SSE}{n-k}$$
    其中 `$n$` 是总样本量，`$k$` 是水平（组）的个数。(题14)
- **组间均方 (MSA)**: 也叫**组间方差**。
    $$MSA = \frac{SSA}{k-1}$$
    (题15)

### 1.1.6 F统计量
- **构造**: **必须用均方相除**，不能用平方和。(题2)
    $$F = \frac{\text{组间均方}}{\text{组内均方}} = \frac{MSA}{MSE}$$
    (题16)
- **性质**: F统计量的值越大，越倾向于**拒绝原假设**。

### 1.1.7 假设检验
- **原假设 ($H_0$)**: 所有总体的均值都相等。
    $$H_0: \mu_1 = \mu_2 = \dots = \mu_k$$
- **备择假设 ($H_1$)**: **不全相等**。(题8)
    $$H_1: \mu_i \text{ 不全相等}$$
    > [!warning] 重要区别
    > 备择假设是“不全相等”，而不是“全部都不相等”。

### 1.1.8 判定系数 R²
- **定义**: 衡量自变量解释因变量变异程度的指标。
- **单因素公式**:
    $$R^2 = \frac{SSA}{SST}$$
    (题17)
- **双因素公式 (UP主提及)**:
    $$R^2 = \frac{SSR + SSC}{SST}$$
    (题21)

### 1.1.9 多重比较 (Post-Hoc Analysis)
- **前提条件**: **必须在拒绝原假设之后**进行。如果接受了原假设（认为各组均值无显著差异），则没有必要进行多重比较。(题18)
- **推断对象**: 用样本均值的差异来推断**总体均值**之间是否存在显著差异。(题19)

### 1.1.10 交互作用
- **定义**: 两个或多个自变量联合起来对因变量产生的新效应。即两个因素对因变量的影响**不是相互独立的**。

## 1.2 二、计算与分析题解析

### 1.2.1 ANOVA 表格计算 (题22-28)

**例1 (题22)**:
- 平方和分解：$SST = SSA + SSE$
- 计算：`A`单元格的值 = $SST - SSE = 33.69 - 26.19 = 7.5$。
- > UP主自嘲：“$7.51$ 选的是A，我这个考试的，要是考试真的这么选的话，我得把自己抽一顿。”
    - (实际计算是$7.50$，选项可能是$7.51$)

**例2 (题23)**:
- **条件**: `$2$`个独立样本，总自由度为`$12$`。
- **推导**:
    - 水平数 `$k=2$`。
    - 总样本量 `$N = \text{总自由度} + 1 = 12 + 1 = 13$`。
    - 组间自由度 `$df_A = k-1 = 2-1 = 1$`。
    - 组内自由度 `$df_E = N-k = 13-2 = 11$`。
    - 验证: $df_A + df_E = 1 + 11 = 12$。

**例3 (题24-25)**:
- `MSE` (组内均方) = $SSE / df_E = 26.19 / 11 \approx 2.38$。
- `MSA` (组间均方) = $SSA / df_A = 7.5 / 1 = 7.5$。
- `F` 统计量 = $MSA / MSE = 7.5 / 2.38 \approx 3.15$。

**例4 (题26-27)**:
- **决策规则**:
    1. **统计量法**: 比较 F 统计量和临界值。
        - 若 $F_{stat} < F_{crit}$，则**接受** $H_0$。
        - 若 $F_{stat} > F_{crit}$，则**拒绝** $H_0$。
    2. **P值法**: 比较 P值 和显著性水平 $\alpha$。
        - 若 $P > \alpha$，则**接受** $H_0$。
        - 若 $P < \alpha$，则**拒绝** $H_0$。

**例5 (题28，挖空填表)**:
- `SSA` = $SST - SSE = 62.7 - 24.7 = 38$。
- `df_E` = $df_{Total} - df_A = 34 - 4 = 30$。
- `MSA` = $SSA / df_A = 24.7 / 4 = 6.175$。
- `MSE` = $SSE / df_E = 38 / 30 \approx 1.27$。
- `F` = $MSA / MSE = 6.175 / 1.27 \approx 4.86$。

### 1.2.2 根据数据计算 (题29-31)

**例1 (题29-30)**:
- **条件**: `$3$`个总体，各选 `$4$`个值，`$SSA=536$`, `$SSE=828$`。
- **计算**:
    - 水平数 `$k=3$`，总样本量 `$N = 3 \times 4 = 12$`。
    - 组间自由度 `$df_A = k-1 = 3-1 = 2$`。
    - 组内自由度 `$df_E = N-k = 12-3 = 9$`。
    - $MSA = SSA / df_A = 536 / 2 = 268$。
    - $MSE = SSE / df_E = 828 / 9 = 92$。
    - $F = MSA / MSE = 268 / 92 \approx 2.91$。
- **决策**:
    - 临界值 $F_{crit} = 4.26$。
    - 因为 $F = 2.91 < 4.26$，所以**接受** $H_0$。

**例2 (题31)**:
- **条件**: `$4$`个总体，各选 `$16$`个值，`$MSA=400$`, `$MSE=5$`。
- **计算**:
    - 水平数 `$k=4$`，总样本量 `$N = 4 \times 16 = 64$`。
    - $F = MSA / MSE = 400 / 5 = 80$。
- **决策**:
    - `F`值 `$80$` 远大于通常的临界值，所以**拒绝** $H_0$。

### 1.2.3 双因素方差分析 (题10.8, 10.12)

- **有无交互作用的判断**:
    - **无交互**: 每个单元格（`行因素` $\times$ `列因素`）**只有 `$1$` 个**观测值。(题10.8)
    - **有交互**: 每个单元格**有 `$2$` 个或以上**的观测值。(题10.12)

- **计算案例 (题10.12)**:
    - **给定**: `$k=3$` (行), `$r=2$` (列), `$m=2$` (单元格内样本数)。
    - **预备计算**: 计算各单元格均值、行均值、列均值、总均值。
        - $\bar{x}_{1\cdot} = 12, \bar{x}_{2\cdot} = 23, \bar{x}_{3\cdot} = 15$
        - $\bar{x}_{\cdot1} = 14, \bar{x}_{\cdot2} = 18$
        - $\bar{x} = 16$
    - **计算平方和**:
        - $SSR = 344$ (行平方和)
        - $SSC = 48$ (列平方和)
        - $SSRC = 56$ (交互作用平方和)
        - $SST = 544$ (总平方和)
        - $SSE = SST - SSR - SSC - SSRC = 544 - 344 - 48 - 56 = 96$
    - **结论**:
        - 广告方案 (行因素) F值大于临界值，**有显著影响**。
        - 地区 (列因素) 和交互作用均不显著。

### 1.2.4 LSD 多重比较法 (题10.5)
1. **进行ANOVA检验**: P值 < `$0.05$`，拒绝 $H_0$，说明均值不全相等，需要多重比较。
2. **计算LSD值**:
   $$LSD = t_{\alpha/2, n-k} \sqrt{MSE (\frac{1}{n_i} + \frac{1}{n_j})}$$
   - UP主计算得到 $LSD = 5.85$ (其中自由度为 `$8$`)。
3. **比较均值差**:
   - 将各组样本均值的差的绝对值 $|\bar{x}_i - \bar{x}_j|$ 与LSD值比较。
   - 若 $|\bar{x}_i - \bar{x}_j| > LSD$，则认为总体均值 $\mu_i$ 和 $\mu_j$ 有显著差异。
   - **结论**: `A` `B` 之间、`B` `C` 之间有显著差异。

## 1.3 三、课后思考题与补充

- **简述方差分析的基本步骤**:
    > [!tip] 答题技巧
    > 根据题目分值调整答案的详细程度。
    > - **简略版 (如3-5分)**:
    >     1. 提出原假设与备择假设。
    >     2. 计算各误差平方和 (SSA, SSE, SST)。
    >     3. 计算检验统计量 F。
    >     4. 决策：比较F值与临界值（或P值与$\alpha$），得出结论。
    > - **详细版 (如10-15分)**: 需要写出具体公式，并结合题目数据进行详细说明。
- **UP主观点**: 考这种纯文字的步骤题意义不大，核心在于会看表、会计算、会解决实际问题。

---

## 1.4 全部问题汇总表

| 问题编号      | 核心内容      | 关键点 / 答案                                  |
| :-------- | :-------- | :---------------------------------------- |
| 选择题 1     | 方差分析的目的   | 判断分类型自变量对数值型因变量的影响。                       |
| 选择题 2     | F统计量的构造   | 必须用**均方**相除，不能用平方和。                       |
| 选择题 3     | 误差来源（组内）  | 同一水平下的误差只包含**随机误差**。                      |
| 选择题 4     | 误差类型      | 不同水平间的误差是**组间误差**。                        |
| 选择题 5     | 误差来源（组间）  | 组间误差包含**随机误差 + 系统误差**。                    |
| 选择题 6     | 误差来源（组内）  | 组内误差只包含**随机误差**。                          |
| 选择题 7     | 方差分析的假定   | 正态性、方差齐性、独立性。                             |
| 选择题 8     | 备择假设的描述   | **不全相等**，而不是“全部都不相等”。                     |
| 选择题 9     | 单因素方差分析定义 | 涉及 `$1$` 个分类型自变量。                         |
| 选择题 10    | 双因素方差分析定义 | 涉及 `$2$` 个分类型自变量。                         |
| 选择题 11    | 平方和定义     | 同一水平下的离差平方和是**组内平方和(SSE)**。               |
| 选择题 12    | 平方和定义     | 各水平之间的离差平方和是**组间平方和(SSA)**。               |
| 选择题 13    | 平方和定义     | 全部观测值的离差平方和是**总平方和(SST)**。                |
| 选择题 14    | 均方定义      | 组内平方和/自由度 = **组内均方(MSE)** 或 组内方差。         |
| 选择题 15    | 均方定义      | 组间平方和/自由度 = **组间均方(MSA)** 或 组间方差。         |
| 选择题 16    | F统计量公式    | $F = MSA / MSE$。                          |
| 选择题 17    | R² 公式     | $R^2 = SSA / SST$。                        |
| 选择题 18    | 多重比较的前提   | **拒绝**原假设($H_0$)之后。                       |
| 选择题 19    | 推断对象      | 推断**总体**均值是否有差异。                          |
| 选择题 20    | 交互作用定义    | 两个因素对因变量的影响**不独立**。                       |
| 选择题 21    | 双因素R²公式   | $R^2 = (SSR + SSC) / SST$。                |
| 选择题 22-28 | ANOVA表计算  | 掌握平方和、自由度、均方、F值的勾稽关系。                     |
| 选择题 29-31 | 数据计算F值并决策 | 根据给定数据计算MSA, MSE, F值，并与临界值比较。             |
| 不定向题      | 概念辨析      | 自变量是分类型；用均方计算F值；推断总体。                     |
| 课后题 10.5  | LSD多重比较   | 拒绝H0后，计算LSD值，比较组间均值差异。                    |
| 课后题 10.7  | ANOVA表填空  | 利用表格内各数值的计算关系完成填空并决策。                     |
| 课后题 10.8  | 无交互双因素分析  | 单元格内仅1个观测值；分别检验两个主效应。                     |
| 课后题 10.12 | 有交互双因素分析  | 计算SSR, SSC, SSRC, SSE, SST，并分别检验主效应和交互效应。 |